<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Time Blocker - Ultimate Pro Corrected</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Light theme earth tones */
            --bg-primary: #f7f5f3;
            --bg-secondary: #e8e4e0;
            --bg-card: #ffffff;
            --text-primary: #2c2c2c;
            --text-secondary: #5a5a5a;
            --text-muted: #8a8a8a;
            --border: #d4c4b0;
            --accent: #c4a484;
            --accent-hover: #b8956f;
            --success: #7a9b76;
            --warning: #d4a574;
            --error: #c47a7a;
            
            /* Category colors - earth tones */
            --sleep: #8b7d6b;
            --work: #6b8b9a;
            --exercise: #7a9b76;
            --meals: #d4a574;
            --commute: #9a8b7d;
            --leisure: #b8956f;
            --study: #7d8b9a;
            --family: #9b7a8b;
            --training: #5a8a9a;
            --recovery: #8a9b7a;
            --therapy: #9a7a6b;
            --media: #b87a9b;
        }

        [data-theme="dark"] {
            /* Dark theme earth tones with better contrast */
            --bg-primary: #2a2520;
            --bg-secondary: #3a342c;
            --bg-card: #4a433a;
            --text-primary: #f0ede8;
            --text-secondary: #d4c4b0;
            --text-muted: #b8a898;
            --border: #5a5248;
            --accent: #c4a484;
            --accent-hover: #d4b494;
            --success: #8aab86;
            --warning: #e4b584;
            --error: #d48a8a;
            
            /* Category colors - lighter for dark mode */
            --sleep: #9b8d7b;
            --work: #7b9baa;
            --exercise: #8aab86;
            --meals: #e4b584;
            --commute: #aa9b8d;
            --leisure: #c8a57f;
            --study: #8d9baa;
            --family: #ab8a9b;
            --training: #6a9aaa;
            --recovery: #9aab8a;
            --therapy: #aa8a7b;
            --media: #c88aab;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: 15px;
            padding: 15px;
            min-height: 100vh;
            max-width: 100vw;
            width: 100%;
            box-sizing: border-box;
            overflow-x: auto;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%; /* Ensure full width usage */
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1em;
            font-weight: 600;
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--accent);
            color: var(--bg-card);
            border: none;
            padding: 12px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .theme-toggle:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* Day Navigation */
        .day-nav {
            text-align: center;
        }

        .day-nav h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .nav-btn {
            background: var(--accent);
            color: var(--bg-card);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .date-picker {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 14px;
            width: 140px;
        }

        .schedule-status {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
            font-weight: 500;
        }

        .schedule-available {
            background: var(--success);
            color: var(--bg-card);
        }

        .schedule-empty {
            background: var(--bg-secondary);
            color: var(--text-muted);
        }

        /* Lifestyle Templates */
        .template-select {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .template-btn {
            width: 100%;
            background: var(--accent);
            color: var(--bg-card);
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .template-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* Week View */
        .week-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* Adjusted for better fit */
            gap: 8px;
            margin-bottom: 15px;
        }

        .week-day {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 8px 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
        }

        .week-day.today {
            background: var(--accent);
            color: var(--bg-card);
        }

        .week-day.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--bg-card);
        }

        .week-day.has-data {
            background: var(--success);
            color: var(--bg-card);
        }

        .week-day:hover {
            transform: scale(1.05);
            border-color: var(--accent);
        }

        .apply-btn {
            width: 100%;
            background: var(--success);
            color: var(--bg-card);
            border: none;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .apply-btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .calendar-nav {
            background: var(--accent);
            color: var(--bg-card);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            background: var(--accent-hover);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 15px;
        }

        .calendar-header-day {
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 8px 4px;
            font-size: 12px;
        }

        .calendar-day {
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: 6px;
            padding: 8px 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            min-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day.today {
            background: var(--accent);
            color: var(--bg-card);
        }

        .calendar-day.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--bg-card);
        }

        .calendar-day.has-data {
            background: var(--success);
            color: var(--bg-card);
        }

        .calendar-day:hover {
            border-color: var(--accent);
            transform: scale(1.1);
        }

        /* Totals */
        .totals {
            margin-top: 10px;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .total-item:last-child {
            border-bottom: none;
        }

        .total-category {
            color: var(--text-secondary);
        }

        .total-hours {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Main Con        .left-column {
            display: flex;
            flex-direction: column;
            gap: 12px;
            grid-column: 1;
            min-width: 220px;
            max-width: 240px;
            font-size: 0.9em;
        } text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: var(--text-primary);
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
        }

        .control-group select,
        .control-group input {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(196, 164, 132, 0.2);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--accent);
            color: var(--bg-card);
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn.success {
            background: var(--success);
        }

        .btn.warning {
            background: var(--warning);
        }

        .btn.error {
            background: var(--error);
        }

        /* Categories */
        .category-form {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: end;
        }

        .category-form input[type="text"] {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
        }

        .category-form input[type="color"] {
            width: 50px;
            height: 42px;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
        }

        .categories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .category {
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category.selected {
            border-color: var(--text-primary);
            transform: scale(1.05);
        }

        .category:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .category .delete-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            cursor: pointer;
            font-size: 12px;
            color: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category .delete-btn:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Time Grid */
        .time-grid {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 1px;
            background: var(--border);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .time-label {
            background: var(--bg-secondary);
            padding: 15px 10px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .time-slot {
            background: var(--bg-card);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            min-height: 50px;
        }

        .time-slot:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
        }

        .time-slot.occupied {
            color: white;
            font-weight: 600;
        }

        .time-slot.preview {
            border: 2px dashed var(--accent);
            background: var(--bg-secondary);
            color: var(--text-muted);
        }

        /* Summary */
        .summary {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .summary h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .summary-content {
            color: var(--text-secondary);
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5em;
        }

        .close-btn {
            background: var(--error);
            color: var(--bg-card);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn:hover {
            background: var(--accent);
        }

        /* Responsive - maintain two columns even on narrow screens */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 220px 1fr;
                padding: 5px;
                gap: 5px;
            }
            
            .left-column {
                min-width: 160px;
                max-width: 180px;
                font-size: 0.8em;
            }
            
            .card {
                padding: 8px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .week-grid {
                grid-template-columns: repeat(7, 1fr);
            }
            
            .calendar-grid {
                gap: 2px;
            }
        }

        /* Category specific colors */
        .category.sleep { background: var(--sleep); color: white; }
        .category.work { background: var(--work); color: white; }
        .category.exercise { background: var(--exercise); color: white; }
        .category.meals { background: var(--meals); color: white; }
        .category.commute { background: var(--commute); color: white; }
        .category.leisure { background: var(--leisure); color: white; }
        .category.study { background: var(--study); color: white; }
        .category.family { background: var(--family); color: white; }
        .category.training { background: var(--training); color: white; }
        .category.recovery { background: var(--recovery); color: white; }
        .category.therapy { background: var(--therapy); color: white; }
        .category.media { background: var(--media); color: white; }

        .time-slot.sleep { background: var(--sleep); }
        .time-slot.work { background: var(--work); }
        .time-slot.exercise { background: var(--exercise); }
        .time-slot.meals { background: var(--meals); }
        .time-slot.commute { background: var(--commute); }
        .time-slot.leisure { background: var(--leisure); }
        .time-slot.study { background: var(--study); }
        .time-slot.family { background: var(--family); }
        .time-slot.training { background: var(--training); }
        .time-slot.recovery { background: var(--recovery); }
        .time-slot.therapy { background: var(--therapy); }
        .time-slot.media { background: var(--media); }

        /* Instructions */
        .instructions {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .instructions h4 {
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .instructions ol {
            color: var(--text-secondary);
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }
    
        /* Multi-column time grid layout */
        .time-grid-wrapper {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
        }

        @media (max-width: 1400px) {
            .time-grid-wrapper {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 700px) {
            .time-grid-wrapper {
                grid-template-columns: 1fr;
            }
        }

        .time-column {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .time-column-header {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
            font-size: 16px;
            font-weight: 600;
        }

    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">☀️ Light</button>
    
    <div class="container">
        <div class="left-column">
            <!-- Day Navigation -->
            <div class="card day-nav">
                <h3>📅 Day Navigation</h3>
                <div class="nav-controls">
                    <button class="nav-btn" onclick="previousDay()">‹</button>
                    <div>
                        <div id="currentDate">Tuesday, October 14, 2025</div>
                        <input type="date" id="datePicker" class="date-picker" onchange="goToDate()">
                    </div>
                    <button class="nav-btn" onclick="nextDay()">›</button>
                </div>
                <div id="scheduleStatus" class="schedule-status schedule-empty">No schedule data for this day</div>
            </div>

            <!-- Lifestyle Templates -->
            <div class="card">
                <h3>🎭 Lifestyle Templates</h3>
                <select id="templateSelect" class="template-select">
                    <option value="">Choose a lifestyle template...</option>
                    <option value="athlete">🏃‍♂️ Professional Athlete</option>
                    <option value="musician">🎵 Professional Musician</option>
                    <option value="college">🎓 College Student</option>
                    <option value="highschool">📚 High School Student</option>
                    <option value="middleschool">📝 Middle School Student</option>
                    <option value="workingdad">👨‍💼 Working Dad</option>
                    <option value="workingmom">👩‍💼 Working Mom</option>
                    <option value="stayathome">🏠 Stay-at-Home Parent</option>
                    <option value="rockstar">🎸 Rock Star</option>
                </select>
                <button class="template-btn" onclick="loadTemplate()">Load Weekly Template</button>
            </div>

            <!-- Current Week -->
            <div class="card">
                <h3>📅 Current Week</h3>
                <div class="week-grid">
                    <div class="week-day" data-day="0" onclick="toggleWeekDay(0)">
                        <div>Sun</div>
                        <div id="weekDay0">12</div>
                    </div>
                    <div class="week-day" data-day="1" onclick="toggleWeekDay(1)">
                        <div>Mon</div>
                        <div id="weekDay1">13</div>
                    </div>
                    <div class="week-day today" data-day="2" onclick="toggleWeekDay(2)">
                        <div>Tue</div>
                        <div id="weekDay2">14</div>
                    </div>
                    <div class="week-day" data-day="3" onclick="toggleWeekDay(3)">
                        <div>Wed</div>
                        <div id="weekDay3">15</div>
                    </div>
                    <div class="week-day" data-day="4" onclick="toggleWeekDay(4)">
                        <div>Thu</div>
                        <div id="weekDay4">16</div>
                    </div>
                </div>
                <div class="week-grid">
                    <div class="week-day" data-day="5" onclick="toggleWeekDay(5)">
                        <div>Fri</div>
                        <div id="weekDay5">17</div>
                    </div>
                    <div class="week-day" data-day="6" onclick="toggleWeekDay(6)">
                        <div>Sat</div>
                        <div id="weekDay6">18</div>
                    </div>
                </div>
                <button class="apply-btn" onclick="applyToWeekDays()">Apply Current Day to Selected Week Days</button>
                
                <div class="totals">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">📊 Week Totals</h4>
                    <div id="weekTotals">No activities this week</div>
                </div>
            </div>

            <!-- Calendar -->
            <div class="card">
                <h3>🗓️ Calendar</h3>
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="previousMonth()">‹</button>
                    <span id="calendarMonth">October 2025</span>
                    <button class="calendar-nav" onclick="nextMonth()">›</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-header-day">S</div>
                    <div class="calendar-header-day">M</div>
                    <div class="calendar-header-day">T</div>
                    <div class="calendar-header-day">W</div>
                    <div class="calendar-header-day">T</div>
                    <div class="calendar-header-day">F</div>
                    <div class="calendar-header-day">S</div>
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
                <button class="apply-btn" onclick="applyToMonthDays()">Apply Current Day to Selected Month Days</button>
                
                <div class="totals">
                    <h4 style="color: var(--text-primary); margin-bottom: 10px;">📈 Month Totals</h4>
                    <div id="monthTotals">No activities this month</div>
                </div>
            </div>

            <!-- Time Settings -->
            <div class="card">
                <h3>⚙️ Time Settings</h3>
                <div class="control-group">
                    <label>Time Block Size:</label>
                    <select id="resolution" onchange="changeResolution()">
                        <option value="60">60 minutes (24 blocks)</option>
                        <option value="30">30 minutes (48 blocks)</option>
                        <option value="15">15 minutes (96 blocks)</option>
                    </select>
                </div>
            </div>

        </div>

        <div class="main-content">
            <div class="header">
                <h1>Daily Time Blocker - Ultimate Pro</h1>
                <p>Complete time management with lifestyle templates, advanced reporting, and calendar integration</p>
            </div>

            <div class="card">
                <h3>🏷️ Activity Categories</h3>
                <div class="category-form">
                    <input type="text" id="categoryName" placeholder="Enter category name">
                    <input type="color" id="categoryColor" value="#c4a484">
                    <button class="btn" onclick="addCategory()">➕ Add</button>
                </div>
                <div class="categories" id="categories">
                    <!-- Categories will be populated by JavaScript -->
                </div>
            </div>

<div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" onclick="showHowToUse()" style="width: 100%; padding: 12px; font-size: 14px; background: var(--accent); color: var(--bg-card); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    💡 How to Use
                </button>
            </div>

            <div class="time-grid" id="timeGrid">
                <!-- Time grid will be populated by JavaScript -->
            </div>

            <div class="summary">
                <h3 id="summaryTitle">Tuesday's Summary</h3>
                <div class="summary-content" id="summaryContent">
                    <p>No activities planned yet</p>
                    <p>Start by selecting a category and clicking time slots, or load a lifestyle template!</p>
                </div>
            </div>

            <!-- Bottom Controls -->
            <div class="controls-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3>💾 Data Management</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportDay()">📤 Export Day</button>
                        <button class="btn success" onclick="importDay()">📥 Import Day</button>
                        <button class="btn warning" onclick="exportFullCalendar()">📊 Export Full Calendar</button>
                        <button class="btn" onclick="importCalendar()">📋 Import Calendar</button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport()">
                    </div>
                </div>

                <div class="card">
                    <h3>📊 Advanced Reports</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="showReports()">📈 Detailed Reports</button>
                        <button class="btn warning" onclick="showComparison()">🔍 Compare Schedules</button>
                    </div>
                </div>

                <div class="card">
                    <h3>📅 Calendar Integration</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportGoogleCalendar()">📅 Google Calendar</button>
                        <button class="btn" onclick="exportOutlook()">📧 Outlook</button>
                        <button class="btn success" onclick="exportICS()">📋 Export ICS File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📊 Detailed Reports</h2>
                <button class="close-btn" onclick="closeModal('reportsModal')">&times;</button>
            </div>
            <div id="reportsContent">
                <!-- Reports content will be populated by JavaScript -->
            </div>

            <!-- Bottom Controls -->
            <div class="controls-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3>💾 Data Management</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportDay()">📤 Export Day</button>
                        <button class="btn success" onclick="importDay()">📥 Import Day</button>
                        <button class="btn warning" onclick="exportFullCalendar()">📊 Export Full Calendar</button>
                        <button class="btn" onclick="importCalendar()">📋 Import Calendar</button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport()">
                    </div>
                </div>

                <div class="card">
                    <h3>📊 Advanced Reports</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="showReports()">📈 Detailed Reports</button>
                        <button class="btn warning" onclick="showComparison()">🔍 Compare Schedules</button>
                    </div>
                </div>

                <div class="card">
                    <h3>📅 Calendar Integration</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportGoogleCalendar()">📅 Google Calendar</button>
                        <button class="btn" onclick="exportOutlook()">📧 Outlook</button>
                        <button class="btn success" onclick="exportICS()">📋 Export ICS File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🔍 Schedule Comparison</h2>
                <button class="close-btn" onclick="closeModal('comparisonModal')">&times;</button>
            </div>
            <div id="comparisonContent">
                <div style="margin-bottom: 20px;">
                    <label>Compare:</label>
                    <select id="comparison1" style="margin: 0 10px; padding: 8px;">
                        <option value="current">Current Schedule</option>
                        <option value="athlete">Professional Athlete</option>
                        <option value="musician">Professional Musician</option>
                        <option value="college">College Student</option>
                        <option value="highschool">High School Student</option>
                        <option value="middleschool">Middle School Student</option>
                        <option value="workingdad">Working Dad</option>
                        <option value="workingmom">Working Mom</option>
                        <option value="stayathome">Stay-at-Home Parent</option>
                        <option value="rockstar">Rock Star</option>
                    </select>
                    <span>vs</span>
                    <select id="comparison2" style="margin: 0 10px; padding: 8px;">
                        <option value="athlete">Professional Athlete</option>
                        <option value="musician">Professional Musician</option>
                        <option value="college">College Student</option>
                        <option value="highschool">High School Student</option>
                        <option value="middleschool">Middle School Student</option>
                        <option value="workingdad">Working Dad</option>
                        <option value="workingmom">Working Mom</option>
                        <option value="stayathome">Stay-at-Home Parent</option>
                        <option value="rockstar">Rock Star</option>
                        <option value="current">Current Schedule</option>
                    </select>
                    <button class="btn" onclick="generateComparison()" style="margin-left: 10px;">Generate Comparison</button>
                </div>
                <div id="comparisonResults">
                    <!-- Comparison results will be populated by JavaScript -->
                </div>
            </div>

            <!-- Bottom Controls -->
            <div class="controls-grid" style="margin-top: 30px;">
                <div class="card">
                    <h3>💾 Data Management</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportDay()">📤 Export Day</button>
                        <button class="btn success" onclick="importDay()">📥 Import Day</button>
                        <button class="btn warning" onclick="exportFullCalendar()">📊 Export Full Calendar</button>
                        <button class="btn" onclick="importCalendar()">📋 Import Calendar</button>
                        <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport()">
                    </div>
                </div>

                <div class="card">
                    <h3>📊 Advanced Reports</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="showReports()">📈 Detailed Reports</button>
                        <button class="btn warning" onclick="showComparison()">🔍 Compare Schedules</button>
                    </div>
                </div>

                <div class="card">
                    <h3>📅 Calendar Integration</h3>
                    <div class="btn-group">
                        <button class="btn" onclick="exportGoogleCalendar()">📅 Google Calendar</button>
                        <button class="btn" onclick="exportOutlook()">📧 Outlook</button>
                        <button class="btn success" onclick="exportICS()">📋 Export ICS File</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentDate = new Date(2025, 9, 14); // October 14, 2025
        let selectedCategory = null;
        let resolution = 60; // minutes
        let scheduleData = {}; // Store all schedule data by date
        let selectedWeekDays = [];
        let selectedMonthDays = [];
        let categories = [
            { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
            { name: 'Work', color: '#6b8b9a', id: 'work' },
            { name: 'Exercise', color: '#7a9b76', id: 'exercise' },
            { name: 'Meals', color: '#d4a574', id: 'meals' },
            { name: 'Commute', color: '#9a8b7d', id: 'commute' },
            { name: 'Leisure', color: '#b8956f', id: 'leisure' },
            { name: 'Study', color: '#7d8b9a', id: 'study' },
            { name: 'Family', color: '#9b7a8b', id: 'family' }
        ];

        // Lifestyle templates with proper time allocation
        const lifestyleTemplates = {
            athlete: {
                name: "Professional Athlete",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Training', color: '#5a8a9a', id: 'training' },
                    { name: 'Recovery', color: '#8a9b7a', id: 'recovery' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Therapy', color: '#9a7a6b', id: 'therapy' },
                    { name: 'Media', color: '#b87a9b', id: 'media' }
                ],
                schedule: {
                    // Hours 0-7: Sleep (8 hours)
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep', 7: 'sleep',
                    // Hours 8-11: Recovery/Prep (4 hours)
                    8: 'recovery', 9: 'recovery', 10: 'recovery', 11: 'recovery',
                    // Hours 12-14: Meals (3 hours)
                    12: 'meals', 13: 'meals', 14: 'meals',
                    // Hours 15-18: Training (4 hours)
                    15: 'training', 16: 'training', 17: 'training', 18: 'training',
                    // Hours 19-20: Recovery (2 hours)
                    19: 'recovery', 20: 'recovery',
                    // Hours 21-22: Media/Personal (2 hours)
                    21: 'media', 22: 'therapy',
                    // Hour 23: Recovery
                    23: 'recovery'
                }
            },
            musician: {
                name: "Professional Musician",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Practice', color: '#7d8b9a', id: 'practice' },
                    { name: 'Performance', color: '#b87a9b', id: 'performance' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Business', color: '#6b8b9a', id: 'business' },
                    { name: 'Leisure', color: '#b8956f', id: 'leisure' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep', 7: 'sleep',
                    8: 'meals', 9: 'business', 10: 'business', 11: 'practice',
                    12: 'meals', 13: 'practice', 14: 'practice', 15: 'practice',
                    16: 'practice', 17: 'meals', 18: 'performance', 19: 'performance',
                    20: 'performance', 21: 'performance', 22: 'leisure', 23: 'leisure'
                }
            },
            college: {
                name: "College Student",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Classes', color: '#7d8b9a', id: 'classes' },
                    { name: 'Study', color: '#6b8b9a', id: 'study' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Social', color: '#b8956f', id: 'social' },
                    { name: 'Exercise', color: '#7a9b76', id: 'exercise' },
                    { name: 'Work', color: '#9a8b7d', id: 'work' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep', 7: 'sleep',
                    8: 'meals', 9: 'classes', 10: 'classes', 11: 'classes',
                    12: 'meals', 13: 'study', 14: 'study', 15: 'work',
                    16: 'work', 17: 'exercise', 18: 'meals', 19: 'study',
                    20: 'study', 21: 'social', 22: 'social', 23: 'social'
                }
            },
            highschool: {
                name: "High School Student",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'School', color: '#7d8b9a', id: 'school' },
                    { name: 'Homework', color: '#6b8b9a', id: 'homework' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Activities', color: '#7a9b76', id: 'activities' },
                    { name: 'Family', color: '#9b7a8b', id: 'family' },
                    { name: 'Free Time', color: '#b8956f', id: 'freetime' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep',
                    7: 'meals', 8: 'school', 9: 'school', 10: 'school', 11: 'school',
                    12: 'meals', 13: 'school', 14: 'school', 15: 'activities',
                    16: 'activities', 17: 'homework', 18: 'meals', 19: 'homework',
                    20: 'family', 21: 'freetime', 22: 'freetime', 23: 'sleep'
                }
            },
            middleschool: {
                name: "Middle School Student",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'School', color: '#7d8b9a', id: 'school' },
                    { name: 'Homework', color: '#6b8b9a', id: 'homework' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Play', color: '#7a9b76', id: 'play' },
                    { name: 'Family', color: '#9b7a8b', id: 'family' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep', 7: 'sleep',
                    8: 'meals', 9: 'school', 10: 'school', 11: 'school',
                    12: 'meals', 13: 'school', 14: 'school', 15: 'play',
                    16: 'play', 17: 'homework', 18: 'meals', 19: 'family',
                    20: 'family', 21: 'play', 22: 'sleep', 23: 'sleep'
                }
            },
            workingdad: {
                name: "Working Dad",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Work', color: '#6b8b9a', id: 'work' },
                    { name: 'Commute', color: '#9a8b7d', id: 'commute' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Family', color: '#9b7a8b', id: 'family' },
                    { name: 'Exercise', color: '#7a9b76', id: 'exercise' },
                    { name: 'Personal', color: '#b8956f', id: 'personal' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep',
                    6: 'exercise', 7: 'meals', 8: 'commute', 9: 'work', 10: 'work', 11: 'work',
                    12: 'meals', 13: 'work', 14: 'work', 15: 'work', 16: 'work', 17: 'commute',
                    18: 'meals', 19: 'family', 20: 'family', 21: 'family', 22: 'personal', 23: 'sleep'
                }
            },
            workingmom: {
                name: "Working Mom",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Work', color: '#6b8b9a', id: 'work' },
                    { name: 'Commute', color: '#9a8b7d', id: 'commute' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Family', color: '#9b7a8b', id: 'family' },
                    { name: 'Household', color: '#8a9b7a', id: 'household' },
                    { name: 'Personal', color: '#b8956f', id: 'personal' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep',
                    6: 'household', 7: 'meals', 8: 'commute', 9: 'work', 10: 'work', 11: 'work',
                    12: 'meals', 13: 'work', 14: 'work', 15: 'work', 16: 'work', 17: 'commute',
                    18: 'meals', 19: 'family', 20: 'family', 21: 'household', 22: 'personal', 23: 'sleep'
                }
            },
            stayathome: {
                name: "Stay-at-Home Parent",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Childcare', color: '#9b7a8b', id: 'childcare' },
                    { name: 'Household', color: '#8a9b7a', id: 'household' },
                    { name: 'Meals', color: '#d4a574', id: 'meals' },
                    { name: 'Exercise', color: '#7a9b76', id: 'exercise' },
                    { name: 'Personal', color: '#b8956f', id: 'personal' },
                    { name: 'Errands', color: '#9a8b7d', id: 'errands' }
                ],
                schedule: {
                    0: 'sleep', 1: 'sleep', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep',
                    6: 'personal', 7: 'meals', 8: 'childcare', 9: 'household', 10: 'errands', 11: 'household',
                    12: 'meals', 13: 'childcare', 14: 'childcare', 15: 'childcare', 16: 'exercise', 17: 'household',
                    18: 'meals', 19: 'childcare', 20: 'childcare', 21: 'personal', 22: 'personal', 23: 'sleep'
                }
            },
            rockstar: {
                name: "Rock Star",
                categories: [
                    { name: 'Sleep', color: '#8b7d6b', id: 'sleep' },
                    { name: 'Performance', color: '#b87a9b', id: 'performance' },
                    { name: 'Recording', color: '#7d8b9a', id: 'recording' },
                    { name: 'Rehearsal', color: '#6b8b9a', id: 'rehearsal' },
                    { name: 'Travel', color: '#9a8b7d', id: 'travel' },
                    { name: 'Interviews', color: '#8a9b7a', id: 'interviews' },
                    { name: 'Party', color: '#b8956f', id: 'party' }
                ],
                schedule: {
                    0: 'party', 1: 'party', 2: 'sleep', 3: 'sleep', 4: 'sleep', 5: 'sleep', 6: 'sleep', 7: 'sleep',
                    8: 'sleep', 9: 'sleep', 10: 'interviews', 11: 'recording',
                    12: 'recording', 13: 'recording', 14: 'rehearsal', 15: 'rehearsal',
                    16: 'travel', 17: 'travel', 18: 'performance', 19: 'performance',
                    20: 'performance', 21: 'performance', 22: 'party', 23: 'party'
                }
            }
        };

        // Initialize the application
        function init() {
            updateDateDisplay();
            generateTimeGrid();
            renderCategories();
            generateCalendar();
            updateWeekView();
            updateTotals();
            
            // Set up date picker
            const datePicker = document.getElementById('datePicker');
            datePicker.value = formatDateForInput(currentDate);
        }

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle');
            
            if (body.hasAttribute('data-theme')) {
                body.removeAttribute('data-theme');
                button.textContent = '☀️ Light';
            } else {
                body.setAttribute('data-theme', 'dark');
                button.textContent = '🌙 Dark';
            }
        }

        // Date navigation
        function previousDay() {
            saveCurrentDay();
            currentDate.setDate(currentDate.getDate() - 1);
            updateDateDisplay();
            loadCurrentDay();
            updateWeekView();
            updateTotals();
        }

        function nextDay() {
            saveCurrentDay();
            currentDate.setDate(currentDate.getDate() + 1);
            updateDateDisplay();
            loadCurrentDay();
            updateWeekView();
            updateTotals();
        }

        function goToDate() {
            const datePicker = document.getElementById('datePicker');
            const newDate = new Date(datePicker.value);
            if (!isNaN(newDate.getTime())) {
                saveCurrentDay();
                currentDate = newDate;
                updateDateDisplay();
                loadCurrentDay();
                updateWeekView();
                updateTotals();
            }
        }

        function updateDateDisplay() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('en-US', options);
            document.getElementById('datePicker').value = formatDateForInput(currentDate);
            
            // Update summary title
            const dayName = currentDate.toLocaleDateString('en-US', { weekday: 'long' });
            document.getElementById('summaryTitle').textContent = `${dayName}'s Summary`;
            
            // Update schedule status
            const dateKey = formatDateKey(currentDate);
            const hasData = scheduleData[dateKey] && Object.keys(scheduleData[dateKey]).length > 0;
            const statusElement = document.getElementById('scheduleStatus');
            
            if (hasData) {
                statusElement.textContent = '✅ Schedule data available';
                statusElement.className = 'schedule-status schedule-available';
            } else {
                statusElement.textContent = 'No schedule data for this day';
                statusElement.className = 'schedule-status schedule-empty';
            }
        }

        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // Save and load day data
        function saveCurrentDay() {
            const dateKey = formatDateKey(currentDate);
            const dayData = {};
            
            // Save time slots
            const timeSlots = document.querySelectorAll('.time-slot.occupied');
            timeSlots.forEach(slot => {
                const time = slot.dataset.time;
                const category = slot.dataset.category;
                if (time && category) {
                    dayData[time] = category;
                }
            });
            
            if (Object.keys(dayData).length > 0) {
                scheduleData[dateKey] = dayData;
            } else {
                delete scheduleData[dateKey];
            }
        }

        function loadCurrentDay() {
            const dateKey = formatDateKey(currentDate);
            const dayData = scheduleData[dateKey] || {};
            
            // Clear current time slots
            const timeSlots = document.querySelectorAll('.time-slot');
            timeSlots.forEach(slot => {
                slot.className = 'time-slot';
                slot.textContent = 'Available';
                delete slot.dataset.category;
            });
            
            // Load saved data
            Object.keys(dayData).forEach(time => {
                const category = dayData[time];
                const slot = document.querySelector(`[data-time="${time}"]`);
                if (slot) {
                    const categoryObj = categories.find(c => c.id === category);
                    if (categoryObj) {
                        slot.className = `time-slot occupied ${category}`;
                        slot.textContent = categoryObj.name;
                        slot.dataset.category = category;
                    }
                }
            });
            
            updateSummary();
        }

        // Resolution change
        function changeResolution() {
            const newResolution = parseInt(document.getElementById('resolution').value);
            if (newResolution !== resolution) {
                saveCurrentDay();
                resolution = newResolution;
                generateTimeGrid();
                loadCurrentDay();
            }
        }

        // Generate time grid based on resolution
        function generateTimeGrid() {
            const timeGrid = document.getElementById('timeGrid');
            timeGrid.innerHTML = '';
            
            const slotsPerHour = 60 / resolution;
            
            // Create wrapper for multi-column layout
            const wrapper = document.createElement('div');
            wrapper.className = 'time-grid-wrapper';
            
            // Define time periods (3 columns)
            const periods = [
                { name: '🌙 Night/Early Morning (12AM-7:59AM)', start: 0, end: 8 },
                { name: '☀️ Daytime (8AM-3:59PM)', start: 8, end: 16 },
                { name: '🌆 Evening/Night (4PM-11:59PM)', start: 16, end: 24 }
            ];
            
            // Create each column
            periods.forEach(period => {
                const column = document.createElement('div');
                column.className = 'time-column';
                
                // Column header
                const header = document.createElement('div');
                header.className = 'time-column-header';
                header.textContent = period.name;
                column.appendChild(header);
                
                // Generate time slots for this period
                for (let hour = period.start; hour < period.end; hour++) {
                    for (let slot = 0; slot < slotsPerHour; slot++) {
                        const minute = slot * resolution;
                        const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        
                        // Time label
                        const timeLabel = document.createElement('div');
                        timeLabel.className = 'time-label';
                        timeLabel.textContent = timeString;
                        column.appendChild(timeLabel);
                        
                        // Time slot
                        const timeSlot = document.createElement('div');
                        timeSlot.className = 'time-slot';
                        timeSlot.textContent = 'Available';
                        timeSlot.dataset.time = timeString;
                        timeSlot.onclick = () => assignCategory(timeSlot);
                        timeSlot.onmouseenter = () => previewCategory(timeSlot);
                        timeSlot.onmouseleave = () => clearPreview(timeSlot);
                        column.appendChild(timeSlot);
                    }
                }
                
                wrapper.appendChild(column);
            });
            
            timeGrid.appendChild(wrapper);
        }

        // Category management
        function renderCategories() {
            const categoriesContainer = document.getElementById('categories');
            categoriesContainer.innerHTML = '';
            
            categories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = `category ${category.id}`;
                categoryElement.style.backgroundColor = category.color;
                categoryElement.onclick = () => selectCategory(category.id);
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = category.name;
                categoryElement.appendChild(nameSpan);
                
                // Add delete button for custom categories (not default ones)
                if (!['sleep', 'work', 'exercise', 'meals', 'commute', 'leisure', 'study', 'family'].includes(category.id)) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-btn';
                    deleteBtn.textContent = '×';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteCategory(category.id);
                    };
                    categoryElement.appendChild(deleteBtn);
                }
                
                categoriesContainer.appendChild(categoryElement);
            });
        }

        function selectCategory(categoryId) {
            selectedCategory = categoryId;
            
            // Update visual selection
            document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('selected');
            });
            
            const selectedElement = document.querySelector(`.category.${categoryId}`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
        }

        function addCategory() {
            const nameInput = document.getElementById('categoryName');
            const colorInput = document.getElementById('categoryColor');
            const name = nameInput.value.trim();
            const color = colorInput.value;
            
            if (!name) {
                alert('Please enter a category name');
                return;
            }
            
            // Check for duplicates
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                alert('Category already exists');
                return;
            }
            
            const id = name.toLowerCase().replace(/\s+/g, '');
            categories.push({ name, color, id });
            
            // Add CSS for the new category
            const style = document.createElement('style');
            style.textContent = `
                .category.${id} { background: ${color} !important; color: white; }
                .time-slot.${id} { background: ${color} !important; }
            `;
            document.head.appendChild(style);
            
            renderCategories();
            nameInput.value = '';
            colorInput.value = '#c4a484';
        }

        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category?')) {
                categories = categories.filter(cat => cat.id !== categoryId);
                
                // Remove from time slots
                document.querySelectorAll(`.time-slot.${categoryId}`).forEach(slot => {
                    slot.className = 'time-slot';
                    slot.textContent = 'Available';
                    delete slot.dataset.category;
                });
                
                renderCategories();
                updateSummary();
            }
        }

        // Time slot interaction
        function assignCategory(slot) {
            if (!selectedCategory) {
                alert('Please select a category first');
                return;
            }
            
            const categoryObj = categories.find(c => c.id === selectedCategory);
            if (!categoryObj) return;
            
            slot.className = `time-slot occupied ${selectedCategory}`;
            slot.textContent = categoryObj.name;
            slot.dataset.category = selectedCategory;
            
            updateSummary();
        }

        function previewCategory(slot) {
            if (!selectedCategory || slot.classList.contains('occupied')) return;
            
            const categoryObj = categories.find(c => c.id === selectedCategory);
            if (!categoryObj) return;
            
            slot.classList.add('preview');
            slot.textContent = categoryObj.name;
        }

        function clearPreview(slot) {
            if (slot.classList.contains('preview')) {
                slot.classList.remove('preview');
                if (!slot.classList.contains('occupied')) {
                    slot.textContent = 'Available';
                }
            }
        }

        // Template loading with proper resolution support
        function loadTemplate() {
            const templateSelect = document.getElementById('templateSelect');
            const templateId = templateSelect.value;
            
            if (!templateId) {
                alert('Please select a template');
                return;
            }
            
            const template = lifestyleTemplates[templateId];
            if (!template) return;
            
            // Update categories
            categories = [...template.categories];
            
            // Add CSS for template categories
            template.categories.forEach(category => {
                const existingStyle = document.querySelector(`style[data-category="${category.id}"]`);
                if (!existingStyle) {
                    const style = document.createElement('style');
                    style.setAttribute('data-category', category.id);
                    style.textContent = `
                        .category.${category.id} { background: ${category.color} !important; color: white; }
                        .time-slot.${category.id} { background: ${category.color} !important; }
                    `;
                    document.head.appendChild(style);
                }
            });
            
            renderCategories();
            
            // Clear current schedule
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.className = 'time-slot';
                slot.textContent = 'Available';
                delete slot.dataset.category;
            });
            
            // Apply template schedule based on current resolution
            const slotsPerHour = 60 / resolution;
            
            Object.keys(template.schedule).forEach(hour => {
                const hourNum = parseInt(hour);
                const categoryId = template.schedule[hour];
                const categoryObj = template.categories.find(c => c.id === categoryId);
                
                if (categoryObj) {
                    // Fill all slots for this hour based on resolution
                    for (let slot = 0; slot < slotsPerHour; slot++) {
                        const minute = slot * resolution;
                        const timeString = `${hourNum.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        const timeSlot = document.querySelector(`[data-time="${timeString}"]`);
                        
                        if (timeSlot) {
                            timeSlot.className = `time-slot occupied ${categoryId}`;
                            timeSlot.textContent = categoryObj.name;
                            timeSlot.dataset.category = categoryId;
                        }
                    }
                }
            });
            
            updateSummary();
            alert(`${template.name} template loaded successfully!`);
        }

        // Week view
        function updateWeekView() {
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                
                const dayElement = document.getElementById(`weekDay${i}`);
                if (dayElement) {
                    dayElement.textContent = day.getDate();
                    
                    const weekDayElement = dayElement.parentElement;
                    weekDayElement.classList.remove('today', 'has-data');
                    
                    // Mark today
                    if (day.toDateString() === currentDate.toDateString()) {
                        weekDayElement.classList.add('today');
                    }
                    
                    // Mark days with data
                    const dateKey = formatDateKey(day);
                    if (scheduleData[dateKey] && Object.keys(scheduleData[dateKey]).length > 0) {
                        weekDayElement.classList.add('has-data');
                    }
                }
            }
        }

        function toggleWeekDay(dayIndex) {
            const dayElement = document.querySelector(`[data-day="${dayIndex}"]`);
            if (selectedWeekDays.includes(dayIndex)) {
                selectedWeekDays = selectedWeekDays.filter(d => d !== dayIndex);
                dayElement.classList.remove('selected');
            } else {
                selectedWeekDays.push(dayIndex);
                dayElement.classList.add('selected');
            }
        }

        function applyToWeekDays() {
            if (selectedWeekDays.length === 0) {
                alert('Please select days to apply the current schedule to');
                return;
            }
            
            const currentDayData = {};
            document.querySelectorAll('.time-slot.occupied').forEach(slot => {
                const time = slot.dataset.time;
                const category = slot.dataset.category;
                if (time && category) {
                    currentDayData[time] = category;
                }
            });
            
            if (Object.keys(currentDayData).length === 0) {
                alert('No schedule data to apply');
                return;
            }
            
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            selectedWeekDays.forEach(dayIndex => {
                const targetDate = new Date(startOfWeek);
                targetDate.setDate(startOfWeek.getDate() + dayIndex);
                const dateKey = formatDateKey(targetDate);
                scheduleData[dateKey] = { ...currentDayData };
            });
            
            // Clear selections
            selectedWeekDays = [];
            document.querySelectorAll('.week-day.selected').forEach(day => {
                day.classList.remove('selected');
            });
            
            updateWeekView();
            updateTotals();
            alert('Schedule applied to selected days!');
        }

        // Calendar
        function generateCalendar() {
            const calendarGrid = document.querySelector('.calendar-grid');
            const headerDays = calendarGrid.querySelectorAll('.calendar-header-day');
            
            // Remove existing day elements
            const existingDays = calendarGrid.querySelectorAll('.calendar-day');
            existingDays.forEach(day => day.remove());
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month display
            document.getElementById('calendarMonth').textContent = 
                new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                dayElement.onclick = () => toggleMonthDay(date);
                
                // Mark today
                if (date.toDateString() === currentDate.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Mark days with data
                const dateKey = formatDateKey(date);
                if (scheduleData[dateKey] && Object.keys(scheduleData[dateKey]).length > 0) {
                    dayElement.classList.add('has-data');
                }
                
                // Dim days from other months
                if (date.getMonth() !== month) {
                    dayElement.style.opacity = '0.3';
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
            updateTotals();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
            updateTotals();
        }

        function toggleMonthDay(date) {
            const dateKey = formatDateKey(date);
            const dayElement = event.target;
            
            if (selectedMonthDays.includes(dateKey)) {
                selectedMonthDays = selectedMonthDays.filter(d => d !== dateKey);
                dayElement.classList.remove('selected');
            } else {
                selectedMonthDays.push(dateKey);
                dayElement.classList.add('selected');
            }
        }

        function applyToMonthDays() {
            if (selectedMonthDays.length === 0) {
                alert('Please select days to apply the current schedule to');
                return;
            }
            
            const currentDayData = {};
            document.querySelectorAll('.time-slot.occupied').forEach(slot => {
                const time = slot.dataset.time;
                const category = slot.dataset.category;
                if (time && category) {
                    currentDayData[time] = category;
                }
            });
            
            if (Object.keys(currentDayData).length === 0) {
                alert('No schedule data to apply');
                return;
            }
            
            selectedMonthDays.forEach(dateKey => {
                scheduleData[dateKey] = { ...currentDayData };
            });
            
            // Clear selections
            selectedMonthDays = [];
            document.querySelectorAll('.calendar-day.selected').forEach(day => {
                day.classList.remove('selected');
            });
            
            generateCalendar();
            updateTotals();
            alert('Schedule applied to selected days!');
        }

        // Summary and totals
        function updateSummary() {
            const summaryContent = document.getElementById('summaryContent');
            const occupiedSlots = document.querySelectorAll('.time-slot.occupied');
            
            if (occupiedSlots.length === 0) {
                summaryContent.innerHTML = `
                    <p>No activities planned yet</p>
                    <p>Start by selecting a category and clicking time slots, or load a lifestyle template!</p>
                `;
                return;
            }
            
            const categoryTotals = {};
            occupiedSlots.forEach(slot => {
                const category = slot.dataset.category;
                const categoryObj = categories.find(c => c.id === category);
                if (categoryObj) {
                    const categoryName = categoryObj.name;
                    categoryTotals[categoryName] = (categoryTotals[categoryName] || 0) + (resolution / 60);
                }
            });
            
            let summaryHTML = '';
            Object.keys(categoryTotals).forEach(categoryName => {
                const hours = categoryTotals[categoryName];
                summaryHTML += `
                    <div class="summary-item">
                        <span class="total-category">${categoryName}</span>
                        <span class="total-hours">${hours.toFixed(1)} hours</span>
                    </div>
                `;
            });
            
            summaryContent.innerHTML = summaryHTML;
        }

        function updateTotals() {
            updateWeekTotals();
            updateMonthTotals();
        }

        function updateWeekTotals() {
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            const weekTotals = {};
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const dateKey = formatDateKey(day);
                const dayData = scheduleData[dateKey] || {};
                
                Object.values(dayData).forEach(categoryId => {
                    const categoryObj = categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const categoryName = categoryObj.name;
                        weekTotals[categoryName] = (weekTotals[categoryName] || 0) + (resolution / 60);
                    }
                });
            }
            
            const weekTotalsElement = document.getElementById('weekTotals');
            if (Object.keys(weekTotals).length === 0) {
                weekTotalsElement.innerHTML = '<div class="total-item">No activities this week</div>';
            } else {
                let totalsHTML = '';
                Object.keys(weekTotals).forEach(categoryName => {
                    const hours = weekTotals[categoryName];
                    totalsHTML += `
                        <div class="total-item">
                            <span class="total-category">${categoryName}</span>
                            <span class="total-hours">${hours.toFixed(1)}h</span>
                        </div>
                    `;
                });
                weekTotalsElement.innerHTML = totalsHTML;
            }
        }

        function updateMonthTotals() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthTotals = {};
            
            Object.keys(scheduleData).forEach(dateKey => {
                const date = new Date(dateKey);
                if (date.getFullYear() === year && date.getMonth() === month) {
                    const dayData = scheduleData[dateKey];
                    Object.values(dayData).forEach(categoryId => {
                        const categoryObj = categories.find(c => c.id === categoryId);
                        if (categoryObj) {
                            const categoryName = categoryObj.name;
                            monthTotals[categoryName] = (monthTotals[categoryName] || 0) + (resolution / 60);
                        }
                    });
                }
            });
            
            const monthTotalsElement = document.getElementById('monthTotals');
            if (Object.keys(monthTotals).length === 0) {
                monthTotalsElement.innerHTML = '<div class="total-item">No activities this month</div>';
            } else {
                let totalsHTML = '';
                Object.keys(monthTotals).forEach(categoryName => {
                    const hours = monthTotals[categoryName];
                    totalsHTML += `
                        <div class="total-item">
                            <span class="total-category">${categoryName}</span>
                            <span class="total-hours">${hours.toFixed(1)}h</span>
                        </div>
                    `;
                });
                monthTotalsElement.innerHTML = totalsHTML;
            }
        }

        // Export/Import functions
        function exportDay() {
            const dateKey = formatDateKey(currentDate);
            const dayData = scheduleData[dateKey] || {};
            
            const exportData = {
                date: dateKey,
                resolution: resolution,
                categories: categories,
                schedule: dayData
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `daily-schedule-${dateKey}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importDay() {
            document.getElementById('importFile').click();
        }

        function handleImport() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (importData.schedule) {
                        // Single day import
                        const dateKey = importData.date || formatDateKey(currentDate);
                        scheduleData[dateKey] = importData.schedule;
                        
                        if (importData.categories) {
                            categories = importData.categories;
                            renderCategories();
                        }
                        
                        if (importData.resolution) {
                            resolution = importData.resolution;
                            document.getElementById('resolution').value = resolution;
                            generateTimeGrid();
                        }
                        
                        loadCurrentDay();
                        updateTotals();
                        alert('Day schedule imported successfully!');
                    } else if (importData.scheduleData) {
                        // Full calendar import
                        scheduleData = importData.scheduleData;
                        
                        if (importData.categories) {
                            categories = importData.categories;
                            renderCategories();
                        }
                        
                        loadCurrentDay();
                        updateWeekView();
                        generateCalendar();
                        updateTotals();
                        alert('Full calendar imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function exportFullCalendar() {
            const exportData = {
                scheduleData: scheduleData,
                categories: categories,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `full-calendar-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importCalendar() {
            document.getElementById('importFile').click();
        }

        // Calendar integration
        function exportICS() {
            let icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Daily Time Blocker//Ultimate Pro//EN',
                'CALSCALE:GREGORIAN'
            ];
            
            Object.keys(scheduleData).forEach(dateKey => {
                const dayData = scheduleData[dateKey];
                const date = new Date(dateKey);
                
                Object.keys(dayData).forEach(time => {
                    const categoryId = dayData[time];
                    const categoryObj = categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const [hours, minutes] = time.split(':').map(Number);
                        const startTime = new Date(date);
                        startTime.setHours(hours, minutes, 0, 0);
                        const endTime = new Date(startTime);
                        endTime.setMinutes(endTime.getMinutes() + resolution);
                        
                        const formatDateTime = (dt) => {
                            return dt.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                        };
                        
                        icsContent.push(
                            'BEGIN:VEVENT',
                            `DTSTART:${formatDateTime(startTime)}`,
                            `DTEND:${formatDateTime(endTime)}`,
                            `SUMMARY:${categoryObj.name}`,
                            `UID:${dateKey}-${time}-${categoryId}@dailytimeblocker.com`,
                            'END:VEVENT'
                        );
                    }
                });
            });
            
            icsContent.push('END:VCALENDAR');
            
            const blob = new Blob([icsContent.join('\r\n')], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `schedule-${new Date().toISOString().split('T')[0]}.ics`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportGoogleCalendar() {
            exportICS();
            alert('ICS file downloaded! Import it into Google Calendar by going to Settings > Import & Export > Import.');
        }

        function exportOutlook() {
            exportICS();
            alert('ICS file downloaded! Import it into Outlook by going to File > Open & Export > Import/Export.');
        }

        // Reports and comparison
        function showReports() {
            const modal = document.getElementById('reportsModal');
            const content = document.getElementById('reportsContent');
            
            // Generate reports content
            content.innerHTML = `
                <div style="margin-bottom: 30px;">
                    <h3>📊 Time Allocation Analysis</h3>
                    <canvas id="reportsChart" width="400" height="200"></canvas>
                </div>
                <div>
                    <h3>📈 Weekly Summary</h3>
                    <div id="weeklyReportData"></div>
                </div>
            `;
            
            modal.classList.add('show');
            
            // Generate chart
            setTimeout(() => {
                generateReportsChart();
                generateWeeklyReport();
            }, 100);
        }

        function generateReportsChart() {
            const ctx = document.getElementById('reportsChart').getContext('2d');
            
            // Calculate current week totals
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            const weekTotals = {};
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const dateKey = formatDateKey(day);
                const dayData = scheduleData[dateKey] || {};
                
                Object.values(dayData).forEach(categoryId => {
                    const categoryObj = categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const categoryName = categoryObj.name;
                        weekTotals[categoryName] = (weekTotals[categoryName] || 0) + (resolution / 60);
                    }
                });
            }
            
            const labels = Object.keys(weekTotals);
            const data = Object.values(weekTotals);
            const colors = labels.map(label => {
                const category = categories.find(c => c.name === label);
                return category ? category.color : '#c4a484';
            });
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        title: {
                            display: true,
                            text: 'Weekly Time Distribution'
                        }
                    }
                }
            });
        }

        function generateWeeklyReport() {
            const reportData = document.getElementById('weeklyReportData');
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            let reportHTML = '<table style="width: 100%; border-collapse: collapse;">';
            reportHTML += '<tr><th style="border: 1px solid var(--border); padding: 8px;">Day</th><th style="border: 1px solid var(--border); padding: 8px;">Total Hours</th><th style="border: 1px solid var(--border); padding: 8px;">Top Activity</th></tr>';
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const dateKey = formatDateKey(day);
                const dayData = scheduleData[dateKey] || {};
                
                const dayTotals = {};
                Object.values(dayData).forEach(categoryId => {
                    const categoryObj = categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const categoryName = categoryObj.name;
                        dayTotals[categoryName] = (dayTotals[categoryName] || 0) + (resolution / 60);
                    }
                });
                
                const totalHours = Object.values(dayTotals).reduce((sum, hours) => sum + hours, 0);
                const topActivity = Object.keys(dayTotals).reduce((a, b) => dayTotals[a] > dayTotals[b] ? a : b, 'None');
                
                reportHTML += `<tr>
                    <td style="border: 1px solid var(--border); padding: 8px;">${day.toLocaleDateString('en-US', { weekday: 'long' })}</td>
                    <td style="border: 1px solid var(--border); padding: 8px;">${totalHours.toFixed(1)}</td>
                    <td style="border: 1px solid var(--border); padding: 8px;">${topActivity}</td>
                </tr>`;
            }
            
            reportHTML += '</table>';
            reportData.innerHTML = reportHTML;
        }

        function showComparison() {
            const modal = document.getElementById('comparisonModal');
            modal.classList.add('show');
        }

        function generateComparison() {
            const comparison1 = document.getElementById('comparison1').value;
            const comparison2 = document.getElementById('comparison2').value;
            const resultsDiv = document.getElementById('comparisonResults');
            
            if (comparison1 === comparison2) {
                alert('Please select two different schedules to compare');
                return;
            }
            
            // Get data for both schedules
            const data1 = getScheduleData(comparison1);
            const data2 = getScheduleData(comparison2);
            
            // Generate comparison
            let comparisonHTML = `
                <div style="margin-bottom: 30px;">
                    <h3>📊 Schedule Comparison: ${getScheduleName(comparison1)} vs ${getScheduleName(comparison2)}</h3>
                    <canvas id="comparisonChart" width="400" height="200"></canvas>
                </div>
                <div>
                    <h3>📈 Detailed Comparison</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <th style="border: 1px solid var(--border); padding: 8px;">Category</th>
                            <th style="border: 1px solid var(--border); padding: 8px;">${getScheduleName(comparison1)}</th>
                            <th style="border: 1px solid var(--border); padding: 8px;">${getScheduleName(comparison2)}</th>
                            <th style="border: 1px solid var(--border); padding: 8px;">Difference</th>
                        </tr>
            `;
            
            const allCategories = new Set([...Object.keys(data1), ...Object.keys(data2)]);
            
            allCategories.forEach(category => {
                const hours1 = data1[category] || 0;
                const hours2 = data2[category] || 0;
                const difference = hours1 - hours2;
                const diffText = difference > 0 ? `+${difference.toFixed(1)}h` : `${difference.toFixed(1)}h`;
                
                comparisonHTML += `<tr>
                    <td style="border: 1px solid var(--border); padding: 8px;">${category}</td>
                    <td style="border: 1px solid var(--border); padding: 8px;">${hours1.toFixed(1)}h</td>
                    <td style="border: 1px solid var(--border); padding: 8px;">${hours2.toFixed(1)}h</td>
                    <td style="border: 1px solid var(--border); padding: 8px; color: ${difference > 0 ? 'green' : difference < 0 ? 'red' : 'inherit'}">${diffText}</td>
                </tr>`;
            });
            
            comparisonHTML += '</table></div>';
            resultsDiv.innerHTML = comparisonHTML;
            
            // Generate comparison chart
            setTimeout(() => {
                generateComparisonChart(data1, data2, getScheduleName(comparison1), getScheduleName(comparison2));
            }, 100);
        }

        function getScheduleData(scheduleId) {
            if (scheduleId === 'current') {
                // Get current day data
                const dateKey = formatDateKey(currentDate);
                const dayData = scheduleData[dateKey] || {};
                const totals = {};
                
                Object.values(dayData).forEach(categoryId => {
                    const categoryObj = categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const categoryName = categoryObj.name;
                        totals[categoryName] = (totals[categoryName] || 0) + (resolution / 60);
                    }
                });
                
                return totals;
            } else {
                // Get template data
                const template = lifestyleTemplates[scheduleId];
                if (!template) return {};
                
                const totals = {};
                Object.values(template.schedule).forEach(categoryId => {
                    const categoryObj = template.categories.find(c => c.id === categoryId);
                    if (categoryObj) {
                        const categoryName = categoryObj.name;
                        totals[categoryName] = (totals[categoryName] || 0) + 1; // 1 hour per slot
                    }
                });
                
                return totals;
            }
        }

        function getScheduleName(scheduleId) {
            if (scheduleId === 'current') return 'Current Schedule';
            const template = lifestyleTemplates[scheduleId];
            return template ? template.name : scheduleId;
        }

        function generateComparisonChart(data1, data2, name1, name2) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            const allCategories = new Set([...Object.keys(data1), ...Object.keys(data2)]);
            const labels = Array.from(allCategories);
            const dataset1 = labels.map(cat => data1[cat] || 0);
            const dataset2 = labels.map(cat => data2[cat] || 0);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: name1,
                            data: dataset1,
                            backgroundColor: 'rgba(196, 164, 132, 0.7)',
                            borderColor: 'rgba(196, 164, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: name2,
                            data: dataset2,
                            backgroundColor: 'rgba(122, 155, 118, 0.7)',
                            borderColor: 'rgba(122, 155, 118, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Time Allocation Comparison'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        }
                    }
                }
            });
        }


        function showHowToUse() {
            const modal = document.getElementById('howToUseModal');
            modal.classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>

    <!-- How to Use Modal -->
    <div id="howToUseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💡 How to Use Ultimate Pro</h2>
                <button class="close-btn" onclick="closeModal('howToUseModal')">&times;</button>
            </div>
            <div style="color: var(--text-secondary);">
                <ol style="padding-left: 20px; line-height: 2;">
                    <li>Choose a lifestyle template or plan your day manually</li>
                    <li>Navigate through days using pagination controls</li>
                    <li>Generate detailed reports (daily/weekly/monthly/annual)</li>
                    <li>Compare with others' schedules</li>
                    <li>Export to Google Calendar or Outlook</li>
                    <li>Analyze patterns and optimize your time</li>
                </ol>
            </div>
        </div>
    </div>

</body>
</html>
